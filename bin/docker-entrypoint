#!/bin/bash -e

# Create db directory if it doesn't exist
mkdir -p /rails/db

# If running the rails server then create or migrate existing database
if [ "${1}" == "./bin/rails" ] && [ "${2}" == "s" ]; then
  # Wait for db directory to be mounted
  until [ -w /rails/db ]; do
    echo "Waiting for db directory to be writable..."
    sleep 1
  done
  
  # Prepare database
  ./bin/rails db:prepare
fi

exec "${@}"
